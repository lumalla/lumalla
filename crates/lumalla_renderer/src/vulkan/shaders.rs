//! Embedded shaders for basic rendering
//!
//! This module provides pre-compiled SPIR-V shaders for basic operations.

use anyhow::Context;

use super::{Device, ShaderModule};

/// SPIR-V bytecode for a fullscreen triangle vertex shader.
///
/// This shader generates a fullscreen triangle from the vertex index,
/// without requiring any vertex buffers. Use with 3 vertices.
///
/// Equivalent GLSL:
/// ```glsl
/// #version 450
/// void main() {
///     vec2 pos[3] = vec2[3](
///         vec2(-1.0, -1.0),
///         vec2( 3.0, -1.0),
///         vec2(-1.0,  3.0)
///     );
///     gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);
/// }
/// ```
#[rustfmt::skip]
pub const FULLSCREEN_TRIANGLE_VERT_SPV: &[u32] = &[
    // SPIR-V magic number and version
    0x07230203, 0x00010000, 0x0008000b, 0x0000002d,
    0x00000000, 0x00020011, 0x00000001, 0x0006000b,
    0x00000001, 0x4c534c47, 0x6474732e, 0x3035342e,
    0x00000000, 0x0003000e, 0x00000000, 0x00000001,
    0x0007000f, 0x00000000, 0x00000004, 0x6e69616d,
    0x00000000, 0x0000000d, 0x00000012, 0x00030003,
    0x00000002, 0x000001c2, 0x00040005, 0x00000004,
    0x6e69616d, 0x00000000, 0x00050005, 0x0000000b,
    0x69736f70, 0x6e6f6974, 0x00000073, 0x00060005,
    0x0000000d, 0x565f6c67, 0x65747265, 0x646e4978,
    0x00007865, 0x00060005, 0x00000012, 0x505f6c67,
    0x65567265, 0x78657472, 0x00000000, 0x00060006,
    0x00000012, 0x00000000, 0x505f6c67, 0x7469736f,
    0x006e6f69, 0x00070006, 0x00000012, 0x00000001,
    0x505f6c67, 0x746e696f, 0x657a6953, 0x00000000,
    0x00070006, 0x00000012, 0x00000002, 0x435f6c67,
    0x4470696c, 0x61747369, 0x0065636e, 0x00070006,
    0x00000012, 0x00000003, 0x435f6c67, 0x446c6c75,
    0x61747369, 0x0065636e, 0x00030005, 0x00000014,
    0x00000000, 0x00040047, 0x0000000d, 0x0000000b,
    0x0000002a, 0x00050048, 0x00000012, 0x00000000,
    0x0000000b, 0x00000000, 0x00050048, 0x00000012,
    0x00000001, 0x0000000b, 0x00000001, 0x00050048,
    0x00000012, 0x00000002, 0x0000000b, 0x00000003,
    0x00050048, 0x00000012, 0x00000003, 0x0000000b,
    0x00000004, 0x00030047, 0x00000012, 0x00000002,
    0x00020013, 0x00000002, 0x00030021, 0x00000003,
    0x00000002, 0x00030016, 0x00000006, 0x00000020,
    0x00040017, 0x00000007, 0x00000006, 0x00000002,
    0x00040015, 0x00000008, 0x00000020, 0x00000000,
    0x0004002b, 0x00000008, 0x00000009, 0x00000003,
    0x0004001c, 0x0000000a, 0x00000007, 0x00000009,
    0x00040020, 0x0000001e, 0x00000007, 0x0000000a,
    0x00040015, 0x0000000c, 0x00000020, 0x00000001,
    0x00040020, 0x0000001f, 0x00000001, 0x0000000c,
    0x0004003b, 0x0000001f, 0x0000000d, 0x00000001,
    0x00040017, 0x0000000f, 0x00000006, 0x00000004,
    0x0004002b, 0x00000008, 0x00000010, 0x00000001,
    0x0004001c, 0x00000011, 0x00000006, 0x00000010,
    0x0006001e, 0x00000012, 0x0000000f, 0x00000006,
    0x00000011, 0x00000011, 0x00040020, 0x00000013,
    0x00000003, 0x00000012, 0x0004003b, 0x00000013,
    0x00000014, 0x00000003, 0x0004002b, 0x0000000c,
    0x00000015, 0x00000000, 0x00040020, 0x00000020,
    0x00000007, 0x00000007, 0x0004002b, 0x00000006,
    0x00000018, 0xbf800000, 0x0005002c, 0x00000007,
    0x00000019, 0x00000018, 0x00000018, 0x0004002b,
    0x00000006, 0x0000001a, 0x40400000, 0x0005002c,
    0x00000007, 0x0000001b, 0x0000001a, 0x00000018,
    0x0005002c, 0x00000007, 0x0000001c, 0x00000018,
    0x0000001a, 0x0006002c, 0x0000000a, 0x0000001d,
    0x00000019, 0x0000001b, 0x0000001c, 0x0004002b,
    0x00000006, 0x00000025, 0x00000000, 0x0004002b,
    0x00000006, 0x00000026, 0x3f800000, 0x00040020,
    0x0000002b, 0x00000003, 0x0000000f, 0x00050036,
    0x00000002, 0x00000004, 0x00000000, 0x00000003,
    0x000200f8, 0x00000005, 0x0004003b, 0x0000001e,
    0x0000000b, 0x00000007, 0x0003003e, 0x0000000b,
    0x0000001d, 0x0004003d, 0x0000000c, 0x00000021,
    0x0000000d, 0x00050041, 0x00000020, 0x00000022,
    0x0000000b, 0x00000021, 0x0004003d, 0x00000007,
    0x00000023, 0x00000022, 0x00050051, 0x00000006,
    0x00000027, 0x00000023, 0x00000000, 0x00050051,
    0x00000006, 0x00000028, 0x00000023, 0x00000001,
    0x00070050, 0x0000000f, 0x00000029, 0x00000027,
    0x00000028, 0x00000025, 0x00000026, 0x00050041,
    0x0000002b, 0x0000002c, 0x00000014, 0x00000015,
    0x0003003e, 0x0000002c, 0x00000029, 0x000100fd,
    0x00010038,
];

/// SPIR-V bytecode for a solid color fragment shader.
///
/// This shader outputs a constant blue color.
///
/// Equivalent GLSL:
/// ```glsl
/// #version 450
/// layout(location = 0) out vec4 outColor;
/// void main() {
///     outColor = vec4(0.2, 0.3, 0.5, 1.0);
/// }
/// ```
#[rustfmt::skip]
pub const SOLID_COLOR_FRAG_SPV: &[u32] = &[
    // SPIR-V magic number and version
    0x07230203, 0x00010000, 0x0008000b, 0x0000000d,
    0x00000000, 0x00020011, 0x00000001, 0x0006000b,
    0x00000001, 0x4c534c47, 0x6474732e, 0x3035342e,
    0x00000000, 0x0003000e, 0x00000000, 0x00000001,
    0x0006000f, 0x00000004, 0x00000004, 0x6e69616d,
    0x00000000, 0x00000009, 0x00030010, 0x00000004,
    0x00000007, 0x00030003, 0x00000002, 0x000001c2,
    0x00040005, 0x00000004, 0x6e69616d, 0x00000000,
    0x00050005, 0x00000009, 0x4374756f, 0x726f6c6f,
    0x00000000, 0x00040047, 0x00000009, 0x0000001e,
    0x00000000, 0x00020013, 0x00000002, 0x00030021,
    0x00000003, 0x00000002, 0x00030016, 0x00000006,
    0x00000020, 0x00040017, 0x00000007, 0x00000006,
    0x00000004, 0x00040020, 0x00000008, 0x00000003,
    0x00000007, 0x0004003b, 0x00000008, 0x00000009,
    0x00000003, 0x0004002b, 0x00000006, 0x0000000a,
    0x3e4ccccd, 0x0004002b, 0x00000006, 0x0000000b,
    0x3e99999a, 0x0004002b, 0x00000006, 0x0000000c,
    0x3f000000, 0x0004002b, 0x00000006, 0x0000000d,
    0x3f800000, 0x0007002c, 0x00000007, 0x0000000e,
    0x0000000a, 0x0000000b, 0x0000000c, 0x0000000d,
    0x00050036, 0x00000002, 0x00000004, 0x00000000,
    0x00000003, 0x000200f8, 0x00000005, 0x0003003e,
    0x00000009, 0x0000000e, 0x000100fd, 0x00010038,
];

/// Creates the fullscreen triangle vertex shader module.
pub fn create_fullscreen_triangle_vert(device: &Device) -> anyhow::Result<ShaderModule> {
    ShaderModule::from_spirv(device, FULLSCREEN_TRIANGLE_VERT_SPV)
        .context("Failed to create fullscreen triangle vertex shader")
}

/// Creates the solid color fragment shader module.
pub fn create_solid_color_frag(device: &Device) -> anyhow::Result<ShaderModule> {
    ShaderModule::from_spirv(device, SOLID_COLOR_FRAG_SPV)
        .context("Failed to create solid color fragment shader")
}
